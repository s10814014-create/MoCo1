<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é™„è¿‘å¥½åƒå¥½ç©</title>

  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f0f8ff;
      color: #333;
      margin: 0;
      padding: 20px;
      text-align: center;
    }
    h2 { font-size: 2em; margin-bottom: 20px; }
    h3 { color: #4CAF50; margin-top: 30px; }
    p { font-size: 1.2em; }
    button {
      background-color: #4CAF50;
      color: white;
      font-size: 1em;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin: 10px;
    }
    button:hover { background-color: #45a049; }
    ul { list-style: none; padding: 0; }
    ul li {
      color: #4CAF50;
      cursor: pointer;
      text-decoration: underline;
      margin: 8px 0;
    }
    input {
      padding: 8px;
      width: 70%;
      font-size: 1em;
    }
    .box {
      background: #fff;
      border-radius: 8px;
      padding: 15px;
      margin-top: 15px;
    }
    .result { font-weight: bold; color: #FF5722; }
  </style>
</head>

<body>

<h2>é™„è¿‘å¥½åƒå¥½ç©</h2>

<!-- ä½ç½® -->
<button onclick="getLocation()">å–å¾—æˆ‘çš„ä½ç½®</button>
<p id="location">å°šæœªå–å¾—ä½ç½®</p>

<!-- è¾²æ°‘æ›† -->
<h3>ğŸ“… ä»Šæ—¥è¾²æ°‘æ›†</h3>
<div class="box">
  <p id="almanacText">è®€å–ä¸­...</p>
  <p id="almanacSuggest" class="result"></p>
</div>

<!-- æ“²ç­Š -->
<h3>ğŸ“¿ æ“²ç­Šåˆ¤æ–·</h3>
<button onclick="throwJiao()">æ“²ç­Š</button>
<p id="jiaoResult">å°šæœªæ“²ç­Š</p>

<!-- é™„è¿‘æ¨è–¦ -->
<h3>ğŸ“ é™„è¿‘æ¨è–¦</h3>
<ul id="places">è«‹å…ˆå–å¾—ä½ç½®</ul>

<!-- è‡ªè¨‚æœå°‹ -->
<h3>ğŸ” è‡ªè¨‚æœå°‹</h3>
<input id="userInput" placeholder="è¼¸å…¥æƒ³æ‰¾çš„åœ°é»">
<br>
<button onclick="searchUserPlace()">æœå°‹</button>

<script>
  let userLat = null;
  let userLon = null;

  /* =====================
     å–å¾—ä½ç½®
  ===================== */
  function getLocation() {
    if (!navigator.geolocation) {
      alert("è£ç½®ä¸æ”¯æ´å®šä½");
      return;
    }

    navigator.geolocation.getCurrentPosition(pos => {
      userLat = pos.coords.latitude;
      userLon = pos.coords.longitude;
      document.getElementById("location").textContent =
        `ç·¯åº¦ï¼š${userLat.toFixed(4)}ï¼Œç¶“åº¦ï¼š${userLon.toFixed(4)}`;
      showPlaces();
    });
  }

  /* =====================
     é™„è¿‘åœ°é»
  ===================== */
  function showPlaces() {
    const list = ["æ˜Ÿå·´å…‹", "éº¥ç•¶å‹", "å…¬åœ’", "å¤œå¸‚", "è³¼ç‰©ä¸­å¿ƒ"];
    const ul = document.getElementById("places");
    ul.innerHTML = "";

    list.forEach(place => {
      const li = document.createElement("li");
      li.textContent = place;
      li.onclick = () => {
        const url =
          `https://www.google.com/maps/search/${place}/@${userLat},${userLon},15z`;
        window.open(url, "_blank");
      };
      ul.appendChild(li);
    });
  }

  function searchUserPlace() {
    const place = document.getElementById("userInput").value.trim();
    if (!place || userLat === null) {
      alert("è«‹å…ˆå–å¾—ä½ç½®ä¸¦è¼¸å…¥åœ°é»");
      return;
    }
    const url =
      `https://www.google.com/maps/search/${place}/@${userLat},${userLon},15z`;
    window.open(url, "_blank");
  }

  /* =====================
     æ“²ç­Š
  ===================== */
  function throwJiao() {
    const a = Math.floor(Math.random() * 2);
    const b = Math.floor(Math.random() * 2);

    let result = "";
    if (a !== b) result = "è–ç­Šï¼šä»Šå¤©éå¸¸é©åˆå‡ºé–€ï¼";
    else if (a === 0) result = "ç¬‘ç­Šï¼šæ™®é€šæ—¥ï¼Œè‡ªè¡Œæ–Ÿé…Œã€‚";
    else result = "é™°ç­Šï¼šä»Šå¤©ä¸å»ºè­°å‡ºé–€ã€‚";

    document.getElementById("jiaoResult").textContent = result;
  }

  /* =====================
     è¾²æ°‘æ›† API
     ä½¿ç”¨å…¬é–‹è¬å¹´æ›†è³‡æ–™
  ===================== */
  function loadAlmanac() {
    fetch("https://api.timelessq.com/time")
      .then(res => res.json())
      .then(data => {
        const lunar = data.lunar?.date || "æœªçŸ¥";
        const yi = data.almanac?.yi || [];
        const ji = data.almanac?.ji || [];

        document.getElementById("almanacText").textContent =
          `è¾²æ›†ï¼š${lunar}\nå®œï¼š${yi.join("ã€")}\nå¿Œï¼š${ji.join("ã€")}`;

        document.getElementById("almanacSuggest").textContent =
          checkGoOut(yi, ji);
      })
      .catch(() => {
        document.getElementById("almanacText").textContent =
          "è¾²æ°‘æ›†è³‡æ–™è¼‰å…¥å¤±æ•—";
        document.getElementById("almanacSuggest").textContent =
          "è«‹è‡ªè¡Œåˆ¤æ–·æ˜¯å¦å‡ºé–€";
      });
  }

  function checkGoOut(yi, ji) {
    const y = yi.includes("å‡ºè¡Œ");
    const j = ji.includes("å‡ºè¡Œ");

    if (y && !j) return "âœ… ä»Šæ—¥è¾²æ°‘æ›†ï¼šé©åˆå‡ºé–€";
    if (y && j) return "âš ï¸ å®œå¿Œçš†æœ‰å‡ºè¡Œï¼Œè«‹æ–Ÿé…Œ";
    if (!y && j) return "ğŸš« ä»Šæ—¥ä¸å»ºè­°å‡ºé–€";
    return "ğŸ“Œ æ™®é€šæ—¥ï¼Œå¯è‡ªè¡Œæ±ºå®š";
  }

  /* =====================
     é é¢è¼‰å…¥æ™‚åŸ·è¡Œ
  ===================== */
  loadAlmanac();
</script>

</body>
</html>
