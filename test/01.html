<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é™„è¿‘å¥½åƒå¥½ç©</title>

  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f4f7fa;
      color: #333;
      margin: 0;
      padding: 20px;
      text-align: center;
    }

    h2 {
      font-size: 2.5em;
      margin-bottom: 20px;
      color: #4CAF50;
    }

    h3 {
      font-size: 1.8em;
      margin-top: 30px;
      color: #388E3C;
    }

    p, li {
      font-size: 1.2em;
      line-height: 1.6;
      margin-bottom: 15px;
    }

    button {
      background-color: #4CAF50;
      color: white;
      font-size: 1em;
      padding: 12px 25px;
      margin: 10px 0;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #45a049;
    }

    input {
      padding: 12px;
      width: 70%;
      margin-bottom: 20px;
      font-size: 1.1em;
      border: 2px solid #4CAF50;
      border-radius: 5px;
      outline: none;
      transition: border-color 0.3s;
    }

    input:focus {
      border-color: #388E3C;
    }

    /* å€å¡ŠèƒŒæ™¯è‰²æ­é… */
    .box {
      background-color: #ffffff;
      border-radius: 8px;
      padding: 20px;
      margin-top: 20px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .location-box {
      background-color: #ffeb3b;
    }

    .jiao-box {
      background-color: #ff7043;
    }

    .places-box {
      background-color: #64b5f6;
    }

    .search-box {
      background-color: #81c784;
    }

    .result {
      font-weight: bold;
      color: #FF5722;
      margin-top: 20px;
    }

    .jiao-images {
      display: flex;
      justify-content: center;
      margin-top: 20px;
    }
    .jiao-images img {
      width: 60px;
      margin: 10px;
    }

  </style>
</head>

<body>

<h2>é™„è¿‘å¥½åƒå¥½ç©</h2>

<!-- ä½ç½® -->
<div class="box location-box">
  <h3>ğŸ” å–å¾—æˆ‘çš„ä½ç½®</h3>
  <button onclick="getLocation()">å–å¾—æˆ‘çš„ä½ç½®</button>
  <p id="location">å°šæœªå–å¾—ä½ç½®</p>
</div>

<!-- è¾²æ°‘æ›† -->
<div class="box">
  <h3>ğŸ“… ä»Šæ—¥è¾²æ°‘æ›†</h3>
  <p id="almanacText">è®€å–ä¸­...</p>
  <p id="almanacSuggest" class="result"></p>
</div>

<!-- æ“²ç­Š -->
<div class="box jiao-box">
  <h3>ğŸ“¿ æ“²ç­Šåˆ¤æ–·</h3>
  <button onclick="throwJiao()">æ“²ç­Š</button>
  <p id="jiaoResult">å°šæœªæ“²ç­Š</p>
  <div id="jiaoImages" class="jiao-images"></div>
</div>

<!-- é™„è¿‘æ¨è–¦ -->
<div class="box places-box">
  <h3>ğŸ“ é™„è¿‘æ¨è–¦</h3>
  <ul id="places">è«‹å…ˆå–å¾—ä½ç½®</ul>
</div>

<!-- è‡ªè¨‚æœå°‹ -->
<div class="box search-box">
  <h3>ğŸ” è‡ªè¨‚æœå°‹</h3>
  <input id="userInput" placeholder="è¼¸å…¥æƒ³æ‰¾çš„åœ°é»">
  <br>
  <button onclick="searchUserPlace()">æœå°‹</button>
</div>

<script>
  let userLat = null;
  let userLon = null;

  /* =====================
     å–å¾—ä½ç½®
  ===================== */
  function getLocation() {
    if (!navigator.geolocation) {
      alert("è£ç½®ä¸æ”¯æ´å®šä½");
      return;
    }

    navigator.geolocation.getCurrentPosition(pos => {
      userLat = pos.coords.latitude;
      userLon = pos.coords.longitude;
      document.getElementById("location").textContent =
        `ç·¯åº¦ï¼š${userLat.toFixed(4)}ï¼Œç¶“åº¦ï¼š${userLon.toFixed(4)}`;
      showPlaces();
    });
  }

  /* =====================
     é™„è¿‘åœ°é»
  ===================== */
  function showPlaces() {
    const list = ["æ˜Ÿå·´å…‹", "éº¥ç•¶å‹", "å…¬åœ’", "å¤œå¸‚", "è³¼ç‰©ä¸­å¿ƒ"];
    const ul = document.getElementById("places");
    ul.innerHTML = "";

    list.forEach(place => {
      const li = document.createElement("li");
      li.textContent = place;
      li.onclick = () => {
        const url =
          `https://www.google.com/maps/search/${place}/@${userLat},${userLon},15z`;
        window.open(url, "_blank");
      };
      ul.appendChild(li);
    });
  }

  function searchUserPlace() {
    const place = document.getElementById("userInput").value.trim();
    if (!place || userLat === null) {
      alert("è«‹å…ˆå–å¾—ä½ç½®ä¸¦è¼¸å…¥åœ°é»");
      return;
    }
    const url =
      `https://www.google.com/maps/search/${place}/@${userLat},${userLon},15z`;
    window.open(url, "_blank");
  }

  /* =====================
     æ“²ç­Š
  ===================== */
  function throwJiao() {
    const a = Math.floor(Math.random() * 2);
    const b = Math.floor(Math.random() * 2);

    let result = "";
    const jiaoImages = document.getElementById("jiaoImages");
    jiaoImages.innerHTML = ""; // æ¸…ç©ºåœ–ç‰‡

    if (a !== b) {
      result = "è–ç­Šï¼šä»Šå¤©éå¸¸é©åˆå‡ºé–€ï¼";
      jiaoImages.innerHTML = `
        <img src="https://via.placeholder.com/60x60.png?text=æ­£" alt="æ­£é¢" />
        <img src="https://via.placeholder.com/60x60.png?text=å" alt="åé¢" />
      `;
    } else if (a === 0) {
      result = "ç¬‘ç­Šï¼šæ™®é€šæ—¥ï¼Œè‡ªè¡Œæ–Ÿé…Œã€‚";
      jiaoImages.innerHTML = `
        <img src="https://via.placeholder.com/60x60.png?text=å" alt="åé¢" />
        <img src="https://via.placeholder.com/60x60.png?text=å" alt="åé¢" />
      `;
    } else {
      result = "é™°ç­Šï¼šä»Šå¤©ä¸å»ºè­°å‡ºé–€ã€‚";
      jiaoImages.innerHTML = `
        <img src="https://via.placeholder.com/60x60.png?text=æ­£" alt="æ­£é¢" />
        <img src="https://via.placeholder.com/60x60.png?text=æ­£" alt="æ­£é¢" />
      `;
    }

    document.getElementById("jiaoResult").textContent = result;
  }

  /* =====================
     è¾²æ°‘æ›† API
     ä½¿ç”¨é¦™æ¸¯å¤©æ–‡å°å…¬é–‹API
  ===================== */
  function loadAlmanac() {
    // å–å¾—ä»Šå¤©çš„æ—¥æœŸ
    const today = new Date();
    const year = today.getFullYear();
    const month = today.getMonth() + 1; // æœˆä»½è¦åŠ  1
    const day = today.getDate();

    const url = `https://data.weather.gov.hk/weatherAPI/opendata/lunardate.php?date=${year}-${month}-${day}&lang=tc`;

    fetch(url)
      .then(res => res.json())
      .then(data => {
        console.log(data); // åœ¨é€™è£¡æª¢æŸ¥ API å›æ‡‰çš„çµæ§‹

        // æª¢æŸ¥è³‡æ–™çµæ§‹ï¼Œè®“ä½ äº†è§£å¦‚ä½•è™•ç†
        const lunar = data.LunarDate || "è³‡æ–™æœªæä¾›";
        const yi = data.Yi || [];
        const ji = data.Ji || [];

        // é¡¯ç¤ºè¾²æ›†æ—¥æœŸ
        document.getElementById("almanacText").textContent =
          `è¾²æ›†ï¼š${lunar}\nå®œï¼š${yi.join("ã€")}\nå¿Œï¼š${ji.join("ã€")}`;

        // é¡¯ç¤ºæ˜¯å¦é©åˆå‡ºé–€
        document.getElementById("almanacSuggest").textContent =
          checkGoOut(yi, ji);
      })
      .catch(() => {
        document.getElementById("almanacText").textContent =
          "è¾²æ°‘æ›†è³‡æ–™è¼‰å…¥å¤±æ•—";
        document.getElementById("almanacSuggest").textContent =
          "è«‹è‡ªè¡Œåˆ¤æ–·æ˜¯å¦å‡ºé–€";
      });
  }

  function checkGoOut(yi, ji) {
    const y = yi.includes("å‡ºè¡Œ");
    const j = ji.includes("å‡ºè¡Œ");

    if (y && !j) return "âœ… ä»Šæ—¥è¾²æ°‘æ›†ï¼šé©åˆå‡ºé–€";
    if (y && j) return "âš ï¸ å®œå¿Œçš†æœ‰å‡ºè¡Œï¼Œè«‹æ–Ÿé…Œ";
    if (!y && j) return "ğŸš« ä»Šæ—¥ä¸å»ºè­°å‡ºé–€";
    return "ğŸ“Œ æ™®é€šæ—¥ï¼Œå¯è‡ªè¡Œæ±ºå®š";
  }

  /* =====================
     é é¢è¼‰å…¥æ™‚åŸ·è¡Œ
  ===================== */
  loadAlmanac();
</script>

</body>
</html>
