<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>附近好吃好玩</title>
<style>
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #f0f8ff;
    color: #333;
    margin: 0;
    padding: 20px;
    text-align: center;
}
h2 {
    font-size: 2em;
    color: #333;
    margin-bottom: 20px;
}
h3 {
    font-size: 1.5em;
    color: #4CAF50;
    margin-bottom: 15px;
}
p, li {
    font-size: 1.2em;
    line-height: 1.6;
}
button {
    background-color: #4CAF50;
    color: white;
    font-size: 1em;
    padding: 12px 25px;
    margin: 10px 0;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s;
}
button:hover {
    background-color: #45a049;
}
input {
    padding: 10px;
    width: 70%;
    margin-bottom: 20px;
    font-size: 1.1em;
    border: 2px solid #4CAF50;
    border-radius: 5px;
    outline: none;
    transition: border-color 0.3s;
}
input:focus {
    border-color: #388E3C;
}
ul {
    list-style-type: none;
    padding: 0;
    margin: 0;
}
ul li {
    cursor: pointer;
    color: #4CAF50;
    text-decoration: underline;
    margin: 10px 0;
    font-size: 1.2em;
}
ul li:hover {
    color: #388E3C;
}
.result {
    font-size: 1.3em;
    font-weight: bold;
    margin-top: 20px;
    color: #FF9800;
}
.jiao-result {
    font-size: 1.5em;
    margin-top: 20px;
    color: #FF5722;
}
.location {
    font-size: 1.1em;
    margin-top: 20px;
    font-weight: bold;
}
.jiao-images {
    display: flex;
    justify-content: center;
    margin-top: 20px;
}
.jiao-images img {
    width: 60px;
    margin: 10px;
}

/* 農民曆顯示樣式 */
iframe {
    width: 100%;
    height: 400px;
    border: none;
    margin-top: 20px;
}
</style>
</head>
<body>

<h2>附近好吃好玩</h2>

<!-- 位置 -->
<button onclick="getLocation()">取得我的位置</button>
<p id="location" class="location">尚未取得資料...</p>

<!-- 擲筊 -->
<h3>擲筊判斷今天適不適合出門</h3>
<button onclick="throwJiao()">擲筊</button>
<p id="jiaoResult" class="jiao-result">尚未擲筊</p>

<!-- 顯示茭圖案 -->
<div id="jiaoImages" class="jiao-images"></div>

<!-- 附近推薦 -->
<h3>附近推薦</h3>
<ul id="places">請先取得位置...</ul>

<!-- 自訂搜尋 -->
<h3>自訂搜尋</h3>
<input type="text" id="userInput" placeholder="輸入你想找的地點">
<button onclick="searchUserPlace()">搜尋</button>

<!-- 農民曆建議 -->
<h3>農民曆建議</h3>
<p id="nongliSuggestion">請擲筊或查看農民曆的建議...</p>

<script>
let userLat = null;
let userLon = null;
let canGoOut = true; // 擲筊結果
let nongliSuggestion = ""; // 農民曆建議

// 取得位置
function getLocation() {
    if (!navigator.geolocation) {
        alert("裝置不支援地理位置");
        return;
    }

    navigator.geolocation.getCurrentPosition(
        function(position) {
            userLat = position.coords.latitude;
            userLon = position.coords.longitude;

            document.getElementById("location").textContent =
                `緯度: ${userLat}, 經度: ${userLon}`;

            showPlaces();
        },
        function(error) {
            alert("無法取得位置: " + error.message);
        }
    );
}

// 顯示附近地點
function showPlaces() {
    const places = ["星巴克", "麥當勞", "全聯", "動物園", "購物中心"];
    const ul = document.getElementById("places");
    ul.innerHTML = "";

    places.forEach(function(place) {
        const li = document.createElement("li");
        li.textContent = place;
        li.onclick = function() {
            const url = `https://www.google.com/maps/search/${encodeURIComponent(place)}/@${userLat},${userLon},15z`;
            window.open(url, "_blank");
        };
        ul.appendChild(li);
    });
}

// 自訂搜尋
function searchUserPlace() {
    const place = document.getElementById("userInput").value.trim();
    if (!place) {
        alert("請輸入要搜尋的地點");
        return;
    }
    if (userLat === null) {
        alert("請先取得位置");
        return;
    }
    const url = `https://www.google.com/maps/search/${encodeURIComponent(place)}/@${userLat},${userLon},15z`;
    window.open(url, "_blank");
}

// 擲筊判斷
function throwJiao() {
    const jiao1 = Math.floor(Math.random() * 2); // 0 or 1
    const jiao2 = Math.floor(Math.random() * 2);

    let text = "";
    const jiaoImages = document.getElementById("jiaoImages");
    jiaoImages.innerHTML = ""; // 清空圖片

    // 擲筊結果的判斷
    if (jiao1 !== jiao2) {
        text = "聖筊：今天非常適合出門！";
        // 顯示正反圖
        jiaoImages.innerHTML = `
        <img src="https://via.placeholder.com/60x60.png?text=正" alt="正面" />
        <img src="https://via.placeholder.com/60x60.png?text=反" alt="反面" />
        `;
        canGoOut = true;
    } else if (jiao1 === 0 && jiao2 === 0) {
        text = "笑筊：今天普通，外出請自行斟酌。";
        // 顯示反反圖
        jiaoImages.innerHTML = `
        <img src="https://via.placeholder.com/60x60.png?text=反" alt="反面" />
        <img src="https://via.placeholder.com/60x60.png?text=反" alt="反面" />
        `;
        canGoOut = true;
    } else {
        text = "陰筊：今天不太適合出門，建議在家休息。";
        // 顯示正正圖
        jiaoImages.innerHTML = `
        <img src="https://via.placeholder.com/60x60.png?text=正" alt="正面" />
        <img src="https://via.placeholder.com/60x60.png?text=正" alt="正面" />
        `;
        canGoOut = false;
    }

    document.getElementById("jiaoResult").textContent = text;

    // 根據日期查詢農民曆建議
    fetchNongliSuggestion();
}

// 從農民曆 API 獲取當天的宜忌建議
function fetchNongliSuggestion() {
    const today = new Date();
    const year = today.getFullYear();
    const month = today.getMonth() + 1; // 月份從0開始
    const date = today.getDate();

    const apiUrl = `https://api.tianapi.com/nongli/index?key=YOUR_API_KEY&date=${year}-${month}-${date}`;

    fetch(apiUrl)
        .then(response => response.json())
        .then(data => {
            if (data && data.result) {
                nongliSuggestion = data.result[0].nongli;

                // 根據擲筊結果與農民曆建議結合
                updateSuggestionBasedOnJiaoResult();
            } else {
                nongliSuggestion = "無法取得農民曆建議，請稍後再試。";
                document.getElementById("nongliSuggestion").textContent = nongliSuggestion;
            }
        })
        .catch(error => {
            nongliSuggestion = "無法連接到農民曆 API，請檢查網路。";
            document.getElementById("nongliSuggestion").textContent = nongliSuggestion;
        });
}

// 根據擲筊結果更新農民曆建議
function updateSuggestionBasedOnJiaoResult() {
    const jiaoResultText = document.getElementById("jiaoResult").textContent;

    if (canGoOut && nongliSuggestion.includes("宜出行")) {
        document.getElementById("nongliSuggestion").textContent = `擲筊結果：${jiaoResultText}，且農民曆建議：今日宜出行！`;
    } else if (!canGoOut && nongliSuggestion.includes("忌出行")) {
        document.getElementById("nongliSuggestion").textContent = `擲筊結果：${jiaoResultText}，且農民曆建議：今日不宜出行，建議在家休息。`;
    } else {
        document.getElementById("nongliSuggestion").textContent = `擲筊結果：${jiaoResultText}，農民曆建議：${nongliSuggestion}`;
    }
}
</script>

</body>
</html>
